{% extends "base.html" %}

{% block content %}
<div class="w-full min-h-screen bg-gray-50 dark:bg-gray-900 midnight:bg-black py-12">
    <div class="w-full px-4 sm:px-6 lg:px-8">
        <div class="w-full max-w-none">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 midnight:text-white mb-2">Setting Up {{ domain }}</h1>
                    <p class="text-gray-600 dark:text-gray-300 midnight:text-gray-300">We're automatically configuring your DNS records...</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 midnight:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 midnight:border-gray-700 p-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 midnight:bg-blue-900 rounded-full flex items-center justify-center">
                                <i class="fas fa-envelope text-blue-600 dark:text-blue-400 midnight:text-blue-300"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900 dark:text-gray-100 midnight:text-white">Mailgun Domain</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 midnight:text-gray-400">Creating mg.{{ domain }}</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 dark:bg-gray-700 midnight:bg-gray-800 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full w-1/3"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 midnight:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 midnight:border-gray-700 p-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 dark:bg-green-900 midnight:bg-green-900 rounded-full flex items-center justify-center">
                                <i class="fas fa-cloud text-green-600 dark:text-green-400 midnight:text-green-300"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900 dark:text-gray-100 midnight:text-white">Cloudflare Zone</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 midnight:text-gray-400">Connecting to zone</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 dark:bg-gray-700 midnight:bg-gray-800 rounded-full h-2">
                                <div class="bg-green-600 h-2 rounded-full w-2/3"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 midnight:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 midnight:border-gray-700 p-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 midnight:bg-purple-900 rounded-full flex items-center justify-center">
                                <i class="fas fa-dns text-purple-600 dark:text-purple-400 midnight:text-purple-300"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900 dark:text-gray-100 midnight:text-white">DNS Records</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 midnight:text-gray-400">Adding records</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 dark:bg-gray-700 midnight:bg-gray-800 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full w-0"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 midnight:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 midnight:border-gray-700 p-8">
                    <div class="text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900 midnight:bg-blue-900 rounded-full mb-4">
                            <i class="fas fa-spinner fa-spin text-blue-600 dark:text-blue-400 midnight:text-blue-300 text-2xl"></i>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 midnight:text-white mb-2">Processing Setup</h2>
                        <p class="text-gray-600 dark:text-gray-400 midnight:text-gray-400 mb-6">This may take a few moments...</p>
                        <button id="start-setup" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                            <i class="fas fa-play mr-2"></i>
                            Begin Setup
                        </button>
                    </div>
                    
                    <div id="setup-results" class="hidden mt-8 space-y-4">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('start-setup').addEventListener('click', async function() {
    const button = this;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Setting up...';
    
    try {
        const response = await fetch('/api/perform-automatic-setup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                domain: '{{ domain }}',
                mailgun_api_key: '{{ mailgun_api_key }}',
                cloudflare_api_key: '{{ cloudflare_api_key }}',
                cloudflare_email: '{{ cloudflare_email }}',
                zone_id: '{{ zone_id }}'
            })
        });
        
        const result = await response.json();
        displayResults(result);
    } catch (error) {
        displayResults({ success: false, error: 'Network error occurred' });
    }
});

function displayResults(result) {
    const resultsDiv = document.getElementById('setup-results');
    resultsDiv.classList.remove('hidden');
    
    if (result.success) {
        resultsDiv.innerHTML = `
            <div class="bg-green-50 dark:bg-green-900/20 midnight:bg-green-900/20 border border-green-200 dark:border-green-800 midnight:border-green-800 rounded-lg p-4">
                <div class="flex items-center space-x-2 text-green-800 dark:text-green-200 midnight:text-green-200">
                    <i class="fas fa-check-circle"></i>
                    <span class="font-semibold">Setup Complete!</span>
                </div>
                <p class="text-green-700 dark:text-green-300 midnight:text-green-300 mt-2">Your Mailgun domain has been configured successfully.</p>
            </div>
        `;
    } else {
        resultsDiv.innerHTML = `
            <div class="bg-red-50 dark:bg-red-900/20 midnight:bg-red-900/20 border border-red-200 dark:border-red-800 midnight:border-red-800 rounded-lg p-4">
                <div class="flex items-center space-x-2 text-red-800 dark:text-red-200 midnight:text-red-200">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="font-semibold">Setup Failed</span>
                </div>
                <p class="text-red-700 dark:text-red-300 midnight:text-red-300 mt-2">${result.error}</p>
            </div>
        `;
    }
}
</script>
{% endblock %}
